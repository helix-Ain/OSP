$.extend($.fn.datagrid.defaults,{settingCode:"",isSys:!1,selectSingle:!0}),$.extend($.fn.datagrid.methods,{init:function(jq,ci_objOptions){return jq.each(function(){function _bindColumns(ci_strData){m_objOptoins.columns=[],m_objOptoins.columns.push(convertToJson(ci_strData));for(var i=0;i<m_objOptoins.columns[0].length;i++)void 0!=m_objOptoins.columns[0][i].formatter&&(m_objOptoins.columns[0][i].formatter=eval("("+m_objOptoins.columns[0][i].formatter+")")),void 0!=m_objOptoins.columns[0][i].field&&"btn"==m_objOptoins.columns[0][i].field&&(m_objOptoins.columns[0][i].resizable=!1,m_objOptoins.columns[0][i].fixed=!0,m_objOptoins.columns[0][i].width=void 0,m_objOptoins.columns[0][i].expander=!0);_init()}function _init(){var i,m_divNoData=$('<div class="nodata">没有相关数据</div>');if(m_objOptoins.onLoadSuccess=function(a){var b,c;void 0==a.rows&&(a.rows=[]),b=m_obj.datagrid("getPager"),$(b).pagination("refresh",{afterPageText:"页，共 {pages} 页",displayMsg:"当前显示 {from} - {to} 条记录，共 {total} 条记录"}),m_obj.datagrid("clearSelections"),0==a.rows.length?(c=m_obj.datagrid("getPanel").find("div .datagrid-body"),c.length>0&&(m_divNoData.removeClass("loaderror").html("没有相关数据").appendTo($(c[c.length-1])),m_divNoData.show())):m_divNoData.hide(),void 0!=ci_objOptions&&void 0!=ci_objOptions.onLoadSuccess&&ci_objOptions.onLoadSuccess.call(m_obj,a)},m_objOptoins.onBeforeLoad=function(param){var m_objData,m_objQuery;return void 0!=param.filterRules&&eval(param.filterRules).length>0&&(m_objData=eval(param.filterRules),m_objQuery=[],$.each(m_objData,function(){var a=8;switch(this.op){case"contains":a=7;break;case"equal":a=1;break;case"notequal":a=6;break;case"less":a=4;break;case"lessorequal":a=5;break;case"greater":a=2;break;case"greaterorequal":a=3}m_objQuery.push(this.field+getSeparativeSign()+a+getSeparativeSign()+this.value)}),param.searchQuery=m_objQuery.join(getSeparativeSign()+","+getSeparativeSign())),void 0!=ci_objOptions&&void 0!=ci_objOptions.onBeforeLoad?ci_objOptions.onBeforeLoad.call(m_obj,param):!0},m_objOptoins.loadFilter=function(a){return checkReturnJson(a),void 0==a&&(a=[]),void 0==a.rows&&(a.rows=[]),void 0==a.total&&(a.total=a.rows.length),void 0!=ci_objOptions&&void 0!=ci_objOptions.loadFilter?ci_objOptions.loadFilter.call(m_obj,a):a},m_objOptoins.onLoadError=function(){m_obj.datagrid("loadData",[]);var a=m_obj.datagrid("getPanel").find("div .datagrid-body");a.length>0&&(m_divNoData.addClass("loaderror").html("数据加载失败").appendTo($(a[a.length-1])),m_divNoData.show()),void 0!=ci_objOptions&&void 0!=ci_objOptions.onLoadError&&ci_objOptions.onLoadError.call(m_obj)},void 0!=ci_objOptions)for(i in ci_objOptions)"onLoadSuccess"!=i&&"loadFilter"!=i&&"onBeforeLoad"!=i&&"onLoadError"!=i&&"url"!=i&&"onClickRow"!=i&&(m_objOptoins[i]=ci_objOptions[i]);m_objOptoins.selectSingle?m_objOptoins.onClickRow=function(a,b){m_obj.datagrid("unselectAll").datagrid("selectRow",a),void 0!=ci_objOptions&&void 0!=ci_objOptions.onClickRow&&ci_objOptions.onClickRow.call(m_obj,a,b)}:void 0!=ci_objOptions&&void 0!=ci_objOptions.onClickRow&&(m_objOptoins.onClickRow=ci_objOptions.onClickRow),0==m_objOptoins.pagination&&(m_objOptoins.remoteSort=!1),""==m_objOptoins.settingCode||void 0==ci_objOptions.url&&""==ci_objOptions.url||(ci_objOptions.url="DcCdDataGridManage",void 0==m_objOptoins.params&&(m_objOptoins.params={Action:"GetData"}),m_objOptoins.params.Action="GetData",m_objOptoins.params.SettingCode=m_objOptoins.settingCode,m_objOptoins.isSys=!0),void 0!=m_objOptoins.params&&(m_objOptoins.queryParams=m_objOptoins.params),void 0!=ci_objOptions.url&&""!=ci_objOptions.url&&(m_objOptoins.url=getInterfaceName(ci_objOptions.url,m_objOptoins.isSys)),m_obj.datagrid(m_objOptoins)}var m_obj=$(this),m_objOptoins={loadMsg:"正在加载数据...",settingCode:"",checkOnSelect:!0,selectOnCheck:!0,singleSelect:!1,selectSingle:!0,remoteSort:!0,fit:!0,fitColumns:!0,isSys:!1,nowrap:!1,striped:!0,rownumbers:!0,pagination:!0,filterInit:!1,filterHide:!0,setColumns:!0,pageNumber:1,pageSize:50};void 0!=m_obj.attr("settingcode")&&""!=m_obj.attr("settingcode")&&(m_objOptoins.settingCode=m_obj.attr("settingcode")),void 0!=ci_objOptions.settingCode&&""!=ci_objOptions.settingCode&&(m_objOptoins.settingCode=ci_objOptions.settingCode),void 0!=ci_objOptions.setColumns&&(m_objOptoins.setColumns=ci_objOptions.setColumns),""!=m_objOptoins.settingCode&&m_objOptoins.setColumns?postData({url:"DcCdDataGridManage",params:{action:"getdatagridcolumns",DataGridCode:m_objOptoins.settingCode},isSys:!0,success:function(a){_bindColumns(a.DcMessage)}}):_init()})},dcnLoad:function(a,b){return a.each(function(){var a=$.data(this,"datagrid").options,c=$(this);c&&a&&(""!=a.settingCode&&(void 0==b&&(b={Action:"GetData"}),b.Action="GetData",b.SettingCode=a.settingCode),c.datagrid("load",b))})}});