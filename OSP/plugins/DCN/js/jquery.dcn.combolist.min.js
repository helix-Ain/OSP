!function(a){function c(b){return{combolist:a(b)}}function d(b){var c=a.data(b,"combolist").options,d=[];return c&&a(">li",b).each(function(){var b={};b[c.valueField]=void 0!=a(this).attr("value")?a(this).attr("value"):a(this).html(),b[c.textField]=a(this).html(),b.selected=a(this).attr("selected"),d.push(b)}),d}function e(c,d){var e,g,h,l,m,n,o,p;if(b=!0,e=a.data(c,"combolist").options,g=a(c),h=a(c).combolist("getValues"),a.data(c,"combolist").data=d,g.empty(),d&&e){if(d.length>0){for(l=a('<ul class="combolist"></ul>').appendTo(g),2==e.alignment&&l.addClass("combolist-vertical"),void 0!=e.bodyCls&&l.addClass(e.bodyCls),void 0==e.hoverCls&&(e.hoverCls="combolist-item-hover"),void 0==e.activeCls&&(e.activeCls="combolist-item-active"),m=0;m<d.length;m++)n=d[m][e.valueField],o=d[m][e.textField],p=a("<li></li>").appendTo(l),p=a("<div></div>").appendTo(p),p.attr("value",n),e.formatter?p.html(e.formatter.call(c,d[m])):p.html(o),p.addClass("combolist-item"),1==e.alignment?(0==m&&p.addClass("combolist-item-first"),m==d.length-1&&p.addClass("combolist-item-last")):2==e.alignment&&p.addClass("combolist-item-vertical"),void 0!=e.itemCls&&p.addClass(e.itemCls),d[m].selected&&function(){for(var a=0;a<h.length;a++)if(n==h[a])return;h.push(n)}();e.multiple?f(c,h):h.length?f(c,[h[h.length-1]]):f(c,[]),a("div.combolist-item",g).click(function(){if(!e.disabled){var b=a(this);e.multiple?b.hasClass(e.activeCls)?j(c,b.attr("value")):i(c,b.attr("value")):e.required?i(c,b.attr("value")):b.hasClass(e.activeCls)?j(c,b.attr("value")):i(c,b.attr("value"))}}).hover(function(){e.disabled||a(this).addClass(e.hoverCls)},function(){e.disabled||a(this).removeClass(e.hoverCls)})}k(c,e.disabled),b=!1,e.onLoadSuccess.call(c,d)}}function f(b,c){var h,i,j,k,m,n,o,d=a.data(b,"combolist").options,e=a.data(b,"combolist").data,f=a(b);if(d&&e&&f){for(h=g(b),i=[],f.find("div."+d.activeCls).removeClass(d.activeCls),j=0;j<c.length;j++){for(k=c[j],m=0;m<e.length&&e[m][d.valueField]!=k;m++);i.push(k),f.find('div[value="'+k+'"]').addClass(d.activeCls)}for(n=[],o=[],j=0;j<h.length;j++)n[j]=h[j];for(j=0;j<i.length;j++)for(m=0;m<n.length;m++)if(i[j]==n[m]){o.push(i[j]),n.splice(m,1);break}(o.length!=i.length||i.length!=h.length)&&(d.multiple?d.onChange.call(b,i,h):d.onChange.call(b,i[0],h[0])),d.required&&l(b,!0)}}function g(b){var c=[],d=a.data(b,"combolist").combolist,e=a.data(b,"combolist").options;return d.find("div."+e.activeCls).each(function(){c.push(a(this).attr("value"))}),c}function h(b){var c=[],d=a.data(b,"combolist").combolist;return d.find("div."+opts.activeCls).each(function(){c.push(a(this).html())}),c}function i(b,c){var g,h,d=a.data(b,"combolist").options,e=a.data(b,"combolist").data;if(d&&e){if(d.multiple){for(g=a(b).combolist("getValues"),h=0;h<g.length;h++)if(g[h]==c)return;g.push(c),f(b,g)}else f(b,[c]);for(h=0;h<e.length;h++)if(e[h][d.valueField]==c)return e[h].selected=!0,d.onSelect.call(b,e[h]),void 0}}function j(b,c){function g(c){var g,h,i,e=d.splice(c,1);if(f(b,d),g=a.data(b,"combolist").options,h=a.data(b,"combolist").data,g&&h)for(i=0;i<h.length;i++)if(h[i][g.valueField]==e[0])return h[i].selected=!1,g.onUnselect.call(b,h[i]),void 0}var e,d=a(b).combolist("getValues");if(c){for(e=0;e<d.length;e++)if(d[e]==c){g(e);break}}else for(e=0;e<d.length;)g(e)}function k(b,c){var f,g,d=a.data(b,"combolist").options,e=a.data(b,"combolist").combolist;if(d&&e)if(c){if(d.disabled=!0,a(b).find("ul").attr("disabled",!0).addClass("combolist-disabled"),e.find(".combolist-item").attr("disabled",!0),a.each(e.find(".combolist-item"),function(){a(this).hasClass(d.activeCls)||a(this).addClass("combolist-disabled-hide")}),1==d.alignment)for(f=e.find("div."+d.activeCls),g=0;g<f.length;g++)0==g&&a(f[g]).addClass("combolist-item-first"),g+1==f.length&&a(f[g]).addClass("combolist-item-last")}else if(d.disabled=!1,a(b).find("ul").removeAttr("disabled").removeClass("combolist-disabled"),e.find(".combolist-item").removeAttr("disabled").removeClass("combolist-disabled-hide").removeClass("combolist-item-first").removeClass("combolist-item-last"),1==d.alignment)for(f=e.find("div.combolist-item"),g=0;g<f.length;g++)0==g&&a(f[g]).addClass("combolist-item-first"),g+1==f.length&&a(f[g]).addClass("combolist-item-last")}function l(c,d){var f,e=a.data(c,"combolist").options;if(e){if(f=g(c),d&&e.required&&!f.length>0)return a(c).find("ul").addClass("combolist-required"),b||(a(c).find("ul").tooltip("destroy").tooltip({content:e.missingMessage}).tooltip("show"),a.parser.parse(a(c).find("ul"))),!1;a(c).find("ul").removeClass("combolist-required").tooltip("destroy")}return!0}function m(b){var c,d;a.data(b,"combolist").data=[],c=a.data(b,"combolist").options,d=a(b),d&&c&&(d.empty(),l(b,!1))}var b=!0;a.fn.combolist=function(b,f){return"string"==typeof b?a.fn.combolist.methods[b](this,f):(b=b||{},this.each(function(){var g,h,f=a.data(this,"combolist");f?(a.extend(f.options,b),void 0!=b.data&&e(this,b.data)):(g=c(this),f=a.data(this,"combolist",{options:a.extend({},a.fn.combolist.defaults,a.fn.combolist.parseOptions(this),b),combolist:g.combolist,previousValue:null}),h=d(this),f.options.data&&(h=f.options.data),e(this,h))}))},a.fn.combolist.methods={options:function(b){return a.data(b[0],"combolist").options},disable:function(a){return a.each(function(){k(this,!0)})},enable:function(a){return a.each(function(){k(this,!1)})},validate:function(a){return a.each(function(){l(this,!0)})},isValid:function(a){return l(a[0],!0)},getData:function(b){return a.data(b[0],"combolist").data},setData:function(b,c){return b.each(function(){a.data(this,"combolist").data=c})},getText:function(a){var b=h(a[0]);return b[0]},getTexts:function(a){return h(a[0])},getValue:function(a){var b=g(a[0]);try{return b[0]}catch(c){return null}},getValues:function(a){return g(a[0])},setValues:function(a,b){return a.each(function(){f(this,b)})},setValue:function(a,b){return a.each(function(){f(this,[b])})},select:function(a,b){return a.each(function(){i(this,b)})},selectFirst:function(b){return b.each(function(){var b,c;try{b=a.data(this,"combolist").data,c=a.data(this,"combolist").options,c&&b&&b.length>0&&i(this,b[0][c.valueField])}catch(d){}})},unselect:function(a,b){return a.each(function(){j(this,b)})},reset:function(a){return a.each(function(){m(this)})}},a.fn.combolist.parseOptions=function(b){var c=a(b);return a.extend({},a.parser.parseOptions(b,["valueField","textField","missingMessage"]),{alignment:parseInt(c.attr("alignment"))>0?parseInt(c.attr("alignment")):1,multiple:c.attr("multiple")?!0:void 0,disabled:c.attr("disabled")?!0:void 0,required:c.attr("required")?!0:void 0,bodyCls:c.attr("bodyCls")?c.attr("bodyCls"):void 0,itemCls:c.attr("itemCls")?c.attr("itemCls"):void 0,hoverCls:c.attr("hoverCls")?c.attr("hoverCls"):void 0,activeCls:c.attr("activeCls")?c.attr("activeCls"):void 0})},a.fn.combolist.defaults={valueField:"value",textField:"text",multiple:!1,disabled:!1,required:!1,missingMessage:"该输入项为必输项",alignment:1,bodyCls:void 0,itemCls:void 0,hoverCls:void 0,activeCls:void 0,data:null,formatter:function(b){var c=a(this).combolist("options");return b[c.textField]},loader:function(b,c,d){var e=a(this).combolist("options");return e.url?(a.ajax({type:e.method,url:e.url,data:b,dataType:"json",success:function(a){c(a)},error:function(){d.apply(this,arguments)}}),void 0):!1},onLoadSuccess:function(){},onChange:function(){},onSelect:function(){},onUnselect:function(){}}}(jQuery);