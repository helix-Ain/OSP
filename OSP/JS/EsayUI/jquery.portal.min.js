(function(e){function t(t,i){e(t).addClass("portal");var s=e('<table border="0" cellspacing="0" cellpadding="0"><tr></tr></table>').appendTo(t),o=s.find("tr"),u=[],a=0;e(t).find(">div").each(function(){var n=e(this);a+=n.outerWidth(),u.push(n.outerWidth());var s=e('<td class="portal-column-td"></td>').appendTo(o);n.addClass("portal-column").appendTo(s),n.find(">div").each(function(){var n=e(this).addClass("portal-p").panel({doSize:!1,cls:"portal-panel"});r(t,n),i.draggable||n.panel("panel").draggable("disable")})});for(var f=0;f<u.length;f++)u[f]/=a;return e(t).bind("_resize",function(){var r=e.data(t,"portal").options;return r.fit==1&&n(t),!1}),u}function n(t){var n=e(t),r=e.data(t,"portal").options;if(r.fit){var i=n.parent();r.width=i.width(),r.height=i.height()}isNaN(r.width)?n.width("auto"):e.boxModel==1?n.width(r.width-(n.outerWidth()-n.width())):n.width(r.width),isNaN(r.height)?n.height("auto"):e.boxModel==1?n.height(r.height-(n.outerHeight()-n.height())):n.height(r.height);var s=n.find(">table").outerHeight()>n.height(),o=n.width(),u=e.data(t,"portal").columnWidths,a=0;for(var f=0;f<u.length;f++){var i=n.find("div.portal-column:eq("+f+")"),l=Math.floor(o*u[f]);f==u.length-1&&(l=o-a-(s==1?28:10)),e.boxModel==1?i.width(l-(i.outerWidth()-i.width())):i.width(l),a+=i.outerWidth(),i.find("div.portal-p").panel("resize",{width:i.width()})}}function r(t,r){function s(n,r){var i=null;return e(t).find("div.portal-p").each(function(){var t=e(this).panel("panel");if(t[0]!=r){var s=t.offset();n.pageX>s.left&&n.pageX<s.left+t.outerWidth()&&n.pageY>s.top&&n.pageY<s.top+t.outerHeight()&&(n.pageY>s.top+t.outerHeight()/2?i={target:t,pos:"down"}:i={target:t,pos:"up"})}}),i}function o(n){var r=null;return e(t).find("div.portal-column").each(function(){var t=e(this),i=t.offset();n.pageX>i.left&&n.pageX<i.left+t.outerWidth()&&(r=t)}),r}function u(t,n){e.boxModel==1?(i.width(t-(i.outerWidth()-i.width())),n&&i.height(n-(i.outerHeight()-i.height()))):(i.width(t),n&&i.height(n))}var i;r.panel("panel").draggable({handle:">div.panel-header>div.panel-title",proxy:function(t){var n=e('<div class="portal-proxy">proxy</div>').insertAfter(t);return n.width(e(t).width()),n.height(e(t).height()),n.html(e(t).html()),n.find("div.portal-p").removeClass("portal-p"),n},onStartDrag:function(t){e(this).hide(),i=e('<div class="portal-spacer"></div>').insertAfter(this),u(e(this).outerWidth(),e(this).outerHeight())},onDrag:function(r){var a=s(r,this);if(a)a.pos=="up"?i.insertBefore(a.target):i.insertAfter(a.target),u(e(a.target).outerWidth());else{var f=o(r);f&&f.find("div.portal-spacer").length==0&&(i.appendTo(f),n(t),u(f.width()))}},onStopDrag:function(r){e(this).css("position","static"),e(this).show(),i.hide(),e(this).insertAfter(i),i.remove(),n(t)}})}e.fn.portal=function(r,i){return typeof r=="string"?e.fn.portal.methods[r](this,i):(r=r||{},this.each(function(){var i=e.data(this,"portal");i?e.extend(i.options,r):i=e.data(this,"portal",{options:e.extend({},e.fn.portal.defaults,e.fn.portal.parseOptions(this),r),columnWidths:t(this,r)}),i.options.border?e(this).removeClass("portal-noborder"):e(this).addClass("portal-noborder"),n(this)}))},e.fn.portal.methods={options:function(t){return e.data(t[0],"portal").options},resize:function(t,r){return t.each(function(){if(r){var t=e.data(this,"portal").options;r.width&&(t.width=r.width),r.height&&(t.height=r.height)}n(this)})},getPanels:function(t,n){var r=t;n&&(r=t.find("div.portal-column:eq("+n+")"));var i=[];return r.find("div.portal-p").each(function(){i.push(e(this))}),i},add:function(t,n){return t.each(function(){var t=e(this).find("div.portal-column:eq("+n.columnIndex+")"),i=n.panel.addClass("portal-p"),s=e.data(this,"portal").options;i.panel("open"),i.panel("panel").addClass("portal-panel").appendTo(t),r(this,i),s.draggable||i.panel("panel").draggable("disable"),i.panel("resize",{width:t.width()})})},remove:function(t,n){return t.each(function(){var t=e(this).portal("getPanels");for(var r=0;r<t.length;r++){var i=t[r];i[0]==e(n)[0]&&i.panel("destroy")}})},enableDraggable:function(e,t){return e.each(function(){t.panel("panel").draggable("enable")})},disableDraggable:function(e,t){return e.each(function(){t.panel("panel").draggable("disable")})}},e.fn.portal.parseOptions=function(t){var n=e(t);return{width:parseInt(t.style.width)||undefined,height:parseInt(t.style.height)||undefined,border:n.attr("border")?n.attr("border")=="true":undefined,fit:n.attr("fit")?n.attr("fit")=="true":undefined,draggable:n.attr("draggable")?n.attr("draggable")=="true":undefined}},e.fn.portal.defaults={width:"auto",height:"auto",border:!0,fit:!1,draggable:!0}})(jQuery)