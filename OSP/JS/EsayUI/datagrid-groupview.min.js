var groupview=$.extend({},$.fn.datagrid.defaults.view,{render:function(e,t,n){var r=$.data(e,"datagrid"),i=r.options,s=r.data.rows,o=$(e).datagrid("getColumnFields",n),u=[],a=0,f=this.groups;for(var l=0;l<f.length;l++){var c=f[l];u.push('<div class="datagrid-group" group-index='+l+' style="height:25px;overflow:hidden;border-bottom:1px solid #ccc;">'),u.push('<table cellspacing="0" cellpadding="0" border="0" style="height:100%"><tbody>'),u.push("<tr>"),u.push('<td style="border:0;">'),n||(u.push('<span style="color:#666;font-weight:bold;">'),u.push(i.groupFormatter.call(e,c.fvalue,c.rows)),u.push("</span>")),u.push("</td>"),u.push("</tr>"),u.push("</tbody></table>"),u.push("</div>"),u.push('<table class="datagrid-btable" cellspacing="0" cellpadding="0" border="0"><tbody>');for(var h=0;h<c.rows.length;h++){var p=a%2&&i.striped?'class="datagrid-row datagrid-row-alt"':'class="datagrid-row"',d=i.rowStyler?i.rowStyler.call(e,a,c.rows[h]):"",v=d?'style="'+d+'"':"",m=r.rowIdPrefix+"-"+(n?1:2)+"-"+a;u.push('<tr id="'+m+'" datagrid-row-index="'+a+'" '+p+" "+v+">"),u.push(this.renderRow.call(this,e,o,n,a,c.rows[h])),u.push("</tr>"),a++}u.push("</tbody></table>")}$(t).html(u.join(""))},onAfterRender:function(e){var t=$.data(e,"datagrid").options,n=$.data(e,"datagrid").dc,r=n.view,i=n.view1,s=n.view2;$.fn.datagrid.defaults.view.onAfterRender.call(this,e);if(t.rownumbers||t.frozenColumns.length)var o=i.find("div.datagrid-group");else var o=s.find("div.datagrid-group");$('<td style="border:0;text-align:center;width:25px"><span class="datagrid-row-expander datagrid-row-collapse" style="display:inline-block;width:16px;height:16px;cursor:pointer">&nbsp;</span></td>').insertBefore(o.find("td")),r.find("div.datagrid-group").each(function(){var t=$(this).attr("group-index");$(this).find("span.datagrid-row-expander").bind("click",{groupIndex:t},function(t){$(this).hasClass("datagrid-row-collapse")?$(e).datagrid("collapseGroup",t.data.groupIndex):$(e).datagrid("expandGroup",t.data.groupIndex)})})},onBeforeRender:function(e,t){function u(e){for(var t=0;t<r.length;t++){var n=r[t];if(n.fvalue==e)return n}return null}var n=$.data(e,"datagrid").options,r=[];for(var i=0;i<t.length;i++){var s=t[i],o=u(s[n.groupField]);o?o.rows.push(s):(o={fvalue:s[n.groupField],rows:[s],startRow:i},r.push(o))}this.groups=r;var a=[];for(var i=0;i<r.length;i++){var o=r[i];for(var f=0;f<o.rows.length;f++)a.push(o.rows[f])}$.data(e,"datagrid").data.rows=a}});$.extend($.fn.datagrid.methods,{expandGroup:function(e,t){return e.each(function(){var e=$.data(this,"datagrid").dc.view;if(t!=undefined)var n=e.find('div.datagrid-group[group-index="'+t+'"]');else var n=e.find("div.datagrid-group");var r=n.find("span.datagrid-row-expander");r.hasClass("datagrid-row-expand")&&(r.removeClass("datagrid-row-expand").addClass("datagrid-row-collapse"),n.next("table").show()),$(this).datagrid("fixRowHeight")})},collapseGroup:function(e,t){return e.each(function(){var e=$.data(this,"datagrid").dc.view;if(t!=undefined)var n=e.find('div.datagrid-group[group-index="'+t+'"]');else var n=e.find("div.datagrid-group");var r=n.find("span.datagrid-row-expander");r.hasClass("datagrid-row-collapse")&&(r.removeClass("datagrid-row-collapse").addClass("datagrid-row-expand"),n.next("table").hide()),$(this).datagrid("fixRowHeight")})}})