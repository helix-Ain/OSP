<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>字码主档</title>

    <script src="../JS/jquery-1.8.3.min.js" type="text/javascript"></script><script type='text/javascript' src='js/Constants.js'></script>

    <script type="text/javascript" src="../JS/CommonScript.js"></script>

</head>
<body class="easyui-layout" data-options="fit:true,border:false" style="display: none;">
    <div data-options="region:'north',border:false,title:'查询条件',iconCls:'dc-icon-search'"
        style="height: 80px;">
        <ul class="searchForm1">
            <li class="searchText1">
                <input type="text" name="cCat" class="dc-search dc-input" dc-tip="请输入主类别" />
            </li>
            <li class="searchText1">
                <input type="text" name="cSubCat" class="dc-search dc-input" dc-tip="请输入副类别" />
            </li>
            <li class="searchText1">
                <input type="text" name="cDesc" class="dc-search dc-input" dc-tip="请输入中文描述" />
            </li>
            <li class="searchText1"><a href="javascript:void(0)" onclick="searchData();" class="dc-button">
                查询</a></li>
        </ul>
    </div>
    <div data-options="region:'center',border:false,onResize:function(){openDetail();}">
        <div id="div_Toolbar" style="display: none;" class="GridButtonBar">
            <span class="GridButtonBarIco"></span><a id="btn_Add" class="easyui-linkbutton" iconcls="dc-icon-editadd"
                plain="true" onclick="newData()">添加</a> <a href="javascript:void(0)" class="easyui-linkbutton"
                    iconcls="dc-icon-pencil" plain="true" onclick="editData()">修改</a> <a href="javascript:void(0)"
                        class="easyui-linkbutton" iconcls="dc-icon-cancel" plain="true" onclick="deleteData()">
                        删除</a>
        </div>
        <table id="tab_List" style="display: none;">
            <thead>
                <tr>
                    <th data-options="field:'ck',checkbox:true">
                    </th>
                    <th data-options="field:'cCat',width:100,sortable:true">
                        主类别
                    </th>
                    <th data-options="field:'cSubCat',width:100,sortable:true">
                        副类别
                    </th>
                    <th data-options="field:'cCodeItem',width:100,sortable:true">
                        字码编号
                    </th>
                    <th data-options="field:'cDesc',width:100,sortable:true">
                        中文描述
                    </th>
                    <th data-options="field:'cEngDesc',width:100,sortable:true">
                        英文描述
                    </th>
                    <th data-options="field:'cRemark',width:150,sortable:true">
                        备注
                    </th>
                    <th data-options="field:'fValue1',width:60,sortable:true">
                        字码值1
                    </th>
                    <th data-options="field:'fValue2',width:60,sortable:true">
                        字码值2
                    </th>
                    <th data-options="field:'cValue3',width:100,sortable:true">
                        字码值3
                    </th>
                    <th data-options="field:'iOrderBy',width:40,sortable:true">
                        排序
                    </th>
                </tr>
            </thead>
        </table>
        <div id="div_Edit" class="easyui-dialog" data-options="closed:true,modal:true,border:false,iconCls:'dc-icon-dialog-title',title:'字码详细资料'"
            style="display: none;">
            <div class="easyui-layout" data-options="fit:true,border:false">
                <div data-options="region:'center',border:false">
                    <form action="" id="form_Edit" method="post" novalidate="novalidate" class="codemasterform">
                    <table style="width: 300px;" class="TableCenter">
                        <tr>
                            <td class="tabletext">
                                主类别：
                            </td>
                            <td class="tableinput">
                                <input name="cCat" class="easyui-validatebox" data-options="required:true" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                副类别：
                            </td>
                            <td>
                                <input name="cSubCat" class="easyui-validatebox" data-options="required:true" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                字码编号：
                            </td>
                            <td>
                                <input name="cCodeItem" class="easyui-validatebox" data-options="required:true" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                中文描述：
                            </td>
                            <td>
                                <input name="cDesc" class="TextEdit" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                英文描述：
                            </td>
                            <td>
                                <input name="cEngDesc" class="TextEdit" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                字码值1：
                            </td>
                            <td>
                                <input name="fValue1" class="TextEdit" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                字码值2：
                            </td>
                            <td>
                                <input name="fValue2" class="TextEdit" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                字码值3：
                            </td>
                            <td>
                                <input name="cValue3" class="TextEdit" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                排序：
                            </td>
                            <td>
                                <input name="iOrderBy" class="easyui-validatebox" data-options="required:true" />
                            </td>
                        </tr>
                        <tr>
                            <td class="tabletext">
                                备注：
                            </td>
                            <td>
                                <input name="cRemark" class="TextEdit" />
                            </td>
                        </tr>
                    </table>
                    </form>
                    <div class="ButtonBar">
                        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="saveData()">保存</a>
                        <a href="javascript:void(0)" class="easyui-linkbutton" onclick="javascript:$('#div_Edit').dialog('close')">
                            取消</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script language="javascript" type="text/javascript">
    var _IsEdit = false;
    var _Action;
    var _ID;
    var arrID = new Array();
    var _ItemData = null;

    checkPagePower({ onload: function() { initPage(); } });

    document.getElementById('div_Edit').style.display = '';

    function initPage() {
        setDataGrid("tab_List", "div_Toolbar", "DcCdCodeMasterManage", { "action": "query" }, "iCodeID", "cCat, cSubCat, iOrderBy, cCodeItem", "", {
            onDblClickRow: function(rowIndex, rowData) { $("#tab_List").datagrid("selectRow", rowIndex); showEditData(); },
            onSelect: function(rowIndex, rowData) { _ItemData = rowData; }
        });

        $('#div_Edit').dialog({ onClose: function() { _IsEdit = false; } });
    }

    function getSearchParameter() {
        var m_objParams = { Action: "query" };
        return getSearchParameters($(".searchForm1"), m_objParams);
    }

    function searchData() {
        $("#tab_List").datagrid("load", getSearchParameter());
    }

    function openDetail() {
        if (_IsEdit) {
            $('#div_Edit').dialog({ width: 350, height: 420 }).dialog('open');
        }
    }

    function showEditData() {
        if (_ItemData != null && $("#tab_List").datagrid("getSelected") != null) {
            $('#form_Edit').form('load', _ItemData);
            _Action = 'edit';
            _ID = _ItemData.iCodeID;
            _IsEdit = true;
            $(".dc-input").dcreset();
            openDetail();
            return true;
        }
        return false;
    }

    function newData() {
        $('#form_Edit').form('clear');
        _Action = 'add';
        _ID = "";
        _IsEdit = true;
        $(".dc-input").dcreset();
        openDetail();
    }

    function editData() {
        if (!showEditData()) {
            $.messager.alert('提示', '请选择记录', 'info');
        }
    }

    function saveData() {
        $('#form_Edit').form('submit', {
            url: getInterfaceName("DcCdCodeMasterManage") + "?action=" + _Action + "&id=" + _ID,
            onSubmit: function() {
                return $(this).form('validate');
            },
            success: function(result) {
                result = convertToJson(result);
                if (checkReturnJson(result)) {
                    $.messager.alert('提示', '保存成功', 'info', function() { $('#div_Edit').dialog('close'); $('#tab_List').datagrid('reload'); })
                }
                else {
                    $.messager.alert('保存失败', result.DcMessage, 'error');
                }
            }
        }).error(function(err) { alert(err.responseText); }); ;
    }

    function deleteData() {
        if (selectDel()) {
            $.messager.confirm('提示', '确定要删除所选' + arrID.length + '条记录吗？', function(r) {
                if (r) {
                    $.post(getInterfaceName("DcCdCodeMasterManage"), { 'id[]': arrID, action: "del" }, function(result) {
                        result = convertToJson(result);
                        if (checkReturnJson(result)) {
                            $.messager.alert('提示', '删除成功', 'info', function() { $('#tab_List').datagrid('reload'); })
                        }
                        else {
                            $.messager.alert('删除失败', result.DcMessage, 'error');
                        }
                    }, 'json');
                }
            });
        }
        else {
            $.messager.alert('提示', '请选择记录', 'info');
        }
    }

    function selectDel() {
        arrID = [];
        var m_row = $('#tab_List').datagrid('getChecked');
        if (m_row.length > 0) {

            $.each(m_row, function(index, value) { arrID[index] = m_row[index].iCodeID; })

            return true;
        }
        return false;
    }
</script>

