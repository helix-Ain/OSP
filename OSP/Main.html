<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<title>全景展示系统</title>

		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

		<script src="JS/jquery-1.8.3.min.js" type="text/javascript"></script>

		<script type='text/javascript' src='js/Constants.js'></script>

		<script type="text/javascript" src="JS/CommonScript.js?script=JS/MenuTree_BMM_New.js,CSS/bmm_main.css"></script>

		<script type="text/javascript" language="javascript">
			function checkHash(cb) {
				var currHash = null;
				setInterval(function() {
					var hash = window.location.hash;
					if(hash == currHash) {
						return false;
					} else {
						currHash = hash;
						cb(hash);
					}
				}, 1)
			}
		</script>
		<style>
			#zhanweishouye {
				background: url(Image/zhanweishouye.png) no-repeat;
				cursor: pointer;
			}
			
			#zhanweishouye:hover {
				background: url(Image/zhanweishouye-hover.png) no-repeat;
			}
			
			#shangyexinxi {
				background: url(Image/shangyexinxi.png) no-repeat;
				cursor: pointer;
			}
			
			#shangyexinxi:hover {
				background: url(Image/shangyexinxi-hover.png) no-repeat;
			}
			
			#quanjingmanyou {
				background: url(Image/quanjingmanyou.png) no-repeat;
				cursor: pointer;
			}
			
			#quanjingmanyou:hover {
				background: url(Image/quanjingmanyou-hover.png) no-repeat;
			}
			
			#tupianguanli {
				background: url(Image/tupianguanli.png) no-repeat;
				cursor:pointer;
			}
			
			#tupianguanli:hover {
				background: url(Image/tupianguanli-hover.png) no-repeat;
			}
			
			#shipinguanli {
				background: url(Image/shipinguanli.png) no-repeat;
				cursor: pointer;
			}
			
			#shipinguanli:hover {
				background: url(Image/shipinguanli-hover.png) no-repeat;
			}
			
			#yinyeguanli {
				background: url(Image/yinyeguanli.png) no-repeat;
				cursor: pointer;
			}
			
			#yinyeguanli:hover {
				background: url(Image/yinyeguanli-hover.png) no-repeat;
			}
			
			#xinjianchangjingzu {
				background: url(Image/xinjianchangjingzu.png) no-repeat;
				cursor: pointer;
			}
			#xinjianchangjingzu:hover{
				background: url(Image/xinjianchangjingzu-hover.png) no-repeat;
			}
			#tianjiachangjing{
				background: url(Image/tianjiachangjing.png) no-repeat;
				cursor:pointer;
			}
			#tianjiachangjing:hover{
				background: url(Image/tianjiachangjing-hover.png) no-repeat;
			}
			#tianjiashangye{
				background: url(Image/tianjiashangye.png) no-repeat;
				cursor: pointer;
			}
			#tianjiashangye:hover{
				background: url(Image/tianjiashangye-hover.png) no-repeat;
			}
			#kuozhanshangye{
				background: url(Image/kuozhanshangye.png) no-repeat;
				cursor: pointer;
			}
			#kuozhanshangye:hover{
				background: url(Image/kuozhanshangye-hover.png) no-repeat;
			}
		</style>
	</head>

	<body style="min-width: 900px; display: none;" class="easyui-layout" data-options="border:false,fit:true">
		<div data-options="region:'north',border:false" style="height: 36px; background-color:#382A24;
        overflow: hidden;">
			<ul class="userdata">
				<li>
					<div id="div_TopMenu_Org" class="nav-menu-item " style="display: none;">
						<span style='color:#be9e8d;font-size: 15px;margin-left:15px;'>浩鸣传媒有限公司</span>
						<em class="nav-select-arr"></em>
					</div>
					<div id="div_Org" class="easyui-menu" style="width: 190px; display: none; background: #fff;" data-options="onClick: orgMenuHandler">
					</div>
				</li>
				<li>
					<div id="div_TopMenu_OrgSwitch" class="nav-menu-item" style="display: none;">
						<span id="span_OrgSwitch"></span><em class="nav-select-arr"></em>
					</div>
					<div id="div_OrgSwitch" class="easyui-menu" style="width: 190px; display: none; background: #fff;">
					</div>
				</li>
				<li group="updatetip" class="nva-menu-item-split"></li>
				<li style="float: right;">
					<div id="div_TopMenu_UserGroup" class="nav-menu-item" style="display: none;">
						<span id="span_UserGroup"></span><em class="nav-select-arr"></em>
					</div>
					<div id="div_UserGroup" class="easyui-menu" style="width: 120px; display: none; background: #fff;" data-options="onClick: userGroupMenuHandler">
					</div>
				</li>
				<li class="nav-menu-item-split" style="float: right;"></li>
				<li style="float: right;">
					<div id="div_TopMenu_User" class="nav-menu-item" style="display: none;">
						<div class="nav-menu-user-default">
						</div>
						<div id="span_User">
						</div>
						<em class="nav-select-arr"></em>
						<div id="mainMenu" class="easyui-menu" style="width: 120px; display: none; background: #fff;" data-options="onClick: mainMenuHandler">
						</div>
					</div>
				</li>
			</ul>
		</div>
		<div data-options="region:'west',border:false" class="dcn-shadow" style="width: 175px;
        overflow: hidden; background-color: #e1e1e1;">
			<div class="easyui-layout" data-options="border:false,fit:true">
				<div data-options="region:'north',border:false" style="height: 80px; overflow: hidden;background-color:#A4684B;">
					<img onclick="location='Main.html'" src="image/01.png" title="" alt="" style='margin-left:25px;margin-top:10px;cursor: pointer;' />
				</div>
				<div id="div_MenuTree" data-options="region:'center',onResize:function(){try{$('div[id^=div_Menu_]').accordion('resize');}catch(ex){}}" style="width: 175px; background: #e1e1e1; border-width: 0px; overflow: hidden;
                font-size: 16px;">
				</div>
			</div>
		</div>
		<div data-options="region:'center',border:false" style="overflow: hidden;">
			<div class="easyui-layout" data-options="border:false,fit:true">
				<div data-options="region:'north',border:false" style="height: 80px; overflow: hidden;">
					<div class='easyui-layout' data-options='border:false,fit:true' style='background-color:#A4684B;'>
						<img src="image/01.png" title="" alt="" style='display: inline-block;margin-left:-149px;margin-bottom:14px;' />
						<div style='margin-left: 75px;display: inline-block;'>
							<div id='xinjianchangjingzu' onclick="top.openTab2('Business','60003')" style='float:left;height: 80px;width:171px;'></div>
							<div style='float:left;margin-top:13px;height:55px;width:1px;background-color:#c4876c;'></div>
							<div id='tianjiachangjing' onclick="top.openTab2('Business','60003','operate=addFile')" style='float:left;height:80px;width:171px;'></div>
							<div style='float:left;margin-top:13px;height:55px;width:1px;background-color:#c4876c;'></div>
							<div id='tianjiashangye' onclick="top.openTab2('Business','60002','operate=newData')" style='float:left;height:80px;width:171px;'></div>
							<div style='float:left;margin-top:13px;height:55px;width:1px;background-color:#c4876c;'></div>
							<div id='kuozhanshangye' onclick="top.openTab2('Business','60003','operate=extendBusiness')" style='float:left;height:80px;width:171px;'></div>
							<div style='float:left;margin-top:13px;height:55px;width:1px;background-color:#c4876c;'></div>
						</div>
					</div>
					<div class="easyui-layout" data-options="border:false,fit:true" style="background-color: #A4684B;">
						<div data-options="region:'center',border:false" style="overflow: hidden; overflow-x: auto">
							<ul id="ul_QuickMenu" class="topMsg" style="display: inline-flex;">
							</ul>
						</div>
					</div>
				</div>
				<div data-options="region:'center',border:false" style="overflow: hidden;">
					<div class="easyui-layout" data-options="border:false,fit:true" style="background-color: #f5f5f5;">
						<div data-options="region:'north',border:false" style="height:10px;background-color:#E7E2DF;">
						</div>
						<div data-options="region:'south',border:false" style="height: 10px;background-color:#E7E2DF;">
						</div>
						<div data-options="region:'west',border:false" style="width: 10px;background-color: #E7E2DF;">
						</div>
						<div data-options="region:'east',border:false" style="width: 10px;background-color: #E7E2DF;">
						</div>
						<div id="div_Content" class="dcn-shadow" data-options="region:'center',border:false" style="overflow: hidden; overflow-x: auto; background-color: White;">
							<div style='position: relative;width:100%;height: 100%;text-align: center;'>
								<div style='font-size: 45px;color:#9B9B9B;margin:25px auto;'>Hi,欢迎你~~</div>
								<div>
									<table id='keyboard-table' cellspacing="0" style='margin:0 auto;'>
										<tr>
											<td id='zhanweishouye' onclick="" style='width:275px;height: 166px;background-size: cover;'></td>
											<td id='shangyexinxi' onclick="top.openTab2('Business','60002')" style='width:275px;height: 166px;background-size: cover;'></td>
											<td id='quanjingmanyou' onclick="top.openTab2('Business','60003')" style='width:275px;height: 166px;background-size: cover;'></td>
										</tr>
										<tr>
											<td id='tupianguanli' onclick="top.openTab2('Business','60101')" style='width:275px;height: 166px;background-size: cover;'></td>
											<td id='shipinguanli' onclick="top.openTab2('Business','60102')" style='width:275px;height: 166px;background-size:cover;'></td>
											<td id='yinyeguanli' onclick="top.openTab2('Business','60105')" style='width:275px;height: 166px;background-size: cover;'></td>
										</tr>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<input type="hidden" id="MainMenuCode" />
	</body>

</html>

<script type="text/javascript">
	var _objWindow = null;
	var _iMenuDelay = 800;
	var _objMenuList = [];
	var _objUserData = {
		cUserName: "",
		cLoginName: "",
		iRoleID: 0,
		iCompanyID: 0,
		iOrgID: 0,
		iUserID: 0,
		iUserGroupID: 0,
		iOrgType: 0
	};
	var _iTryTimes = 500;
	var _iTryDelay = 400;
	var _bShowError = false;
	var _bOpenDesktop = true;
	var _bShowGuide = true;

	function setTopMenu(ci_strDiv, ci_strMenu) {
		$('#' + ci_strDiv + ',#' + ci_strMenu).unbind('mouseenter').unbind('mouseleave');
		$('#' + ci_strDiv).hover(function() {
			$(".easyui-menu").menu("hide");
			$('#' + ci_strMenu).menu('show', {
				left: $('#' + ci_strDiv).offset().left,
				top: $('#' + ci_strDiv).offset().top + $('#' + ci_strDiv).height()
			});
			$(this).addClass('nav-menu-item-hover');
		}, function() {
			setMenuCloseTime(ci_strMenu);
		});
		$('#' + ci_strMenu).menu({
			onShow: function() {
				cancelMenuCloseTime(ci_strMenu);
			},
			onHide: function() {
				$('#' + ci_strDiv).removeClass('nav-menu-item-hover');
			}
		}).hover(function() {
			cancelMenuCloseTime(ci_strMenu);
		});
	}

	function controlSetting() {
		$("#mb").bind('mouseenter', function() {
			cancelMenuCloseTime('mm');
		}).bind('mouseleave', function() {
			setMenuCloseTime('mm');
		});
		$("#mm").bind('mouseenter', function() {
			cancelMenuCloseTime('mm');
		});

		setTopMenu('div_TopMenu_User', 'mainMenu');

		$('#a_WX').tooltip({
			position: 'bottom',
			content: '<img src="image/bmm/10-3.jpg" width="160" /><div style="width:160px;">使用微信扫描二维码关注数云商业智能即可使用微信版</div>'
		});
		$('#a_Mobile').tooltip({
			position: 'bottom',
			content: '<img src="image/bmm/appdown.png" width="160" /><div style="width:160px;text-align:center;">扫描二维码也可以下载手机版</div>'
		});
	}

	checkPagePower({
		onload: function() {
			initPage();
		}
	});

	function initPage() {
		controlSetting();
		$('[group="updatetip"]').hide();
		$('body').css('display', '');
		$('.dcn-shadow').parent().addClass('shadow');
		try {
			getUserData();
		} catch(ex) {}
		_bInitMask = false;
		hiddMask();
	}

	function getUserData() {
		postData({
			url: "DcCdUserManage",
			params: {
				Action: "GetUserInfo"
			},
			success: function(ci_result) {
				if(ci_result.rows != undefined && ci_result.rows.length > 0) {
					_objUserData = ci_result.rows[0];
				}
				_objUserData.iUserID = parseInt(ci_result.rows[0].iUserID);
				$("#span_User").html(_objUserData.cUserName);
				setCookie('loginname', _objUserData.cLoginName);
				$('#div_TopMenu_User').css('display', '');

				getMainMenu();
				getOrgList();
			}
		});
	}

	function getMainMenu() {
		$('#mainMenu').empty();
		postData({
			url: "DcCdMenu",
			params: {
				Action: "mainmenu"
			},
			success: function(ci_result) {
				var m_strMenuCode = '';
				try {
					if(ci_result.rows != undefined && ci_result.rows.length > 0) {
						for(i = 0; i < ci_result.rows.length; i++) {
							$('#mainMenu').menu('appendItem', {
								text: ci_result.rows[i].cItemChiName,
								name: ci_result.rows[i].cClickUrl,
								id: ci_result.rows[i].cMenuItemCode
							});
							if(ci_result.rows[i].cMenuItemCode == 'Business') {
								m_strMenuCode = ci_result.rows[i].cMenuItemCode;
							}
						}
						if(m_strMenuCode == '') {
							m_strMenuCode = ci_result.rows[0].cMenuItemCode;
						}
					}
					$('#mainMenu').menu('appendItem', {
						text: '用户退出',
						name: '用户退出',
						id: 'UserLogout'
					});
				} catch(ex) {}
				createMenuTree(m_strMenuCode, '', false, '');

				checkHash(function(ha) {
					var m_strPage = getHashValue("p");
					if(m_strPage != '' && m_strPage != '#') {
						m_strPage = base64decode(m_strPage);
						var m_strDetail = m_strPage.split(getSeparativeSign());
						if(m_strDetail.length >= 2 && _strMenuCode != m_strDetail[1]) {
							_bOpenDesktop = false;
							setTimeout(function() {
								_bOpenDesktop = true;
								if(m_strDetail[1] == "Desktop") {
									top.location.hash = '';
									openDesktop();
								} else {
									createMenuTree(m_strDetail[0], m_strDetail[1]);
								}
							}, 100);
						}
					}
				});
			}
		});
	}

	function openDesktop() {
		if(_objUserData.iUserGroupID > 0 && _objUserData.iOrgID > 0 && _bOpenDesktop && getHashValue("p") == '') {
			setTimeout(function() {
				$('#div_MenuTree').find('.tree-node-selected').removeClass('tree-node-selected');
				openTab('Business', 'Desktop', '桌面', 'Platform/Desktop.html', '', false, 'RoleID=' + _objUserData.iUserGroupID);
			}, 100);
		}
	}

	function getOrgList() {
		$('[group="updatetip"],#div_TopMenu_OrgSwitch,#div_TopMenu_Org').hide().unbind('mouseenter').unbind('mouseleave').removeClass('nav-menu-item-hover').removeClass('nav-menu-item-only');
		$('#div_Org,#div_OrgSwitch').empty();
		var m_objData = {
			iOrgID: 0,
			cOrgName: '',
			iOrgPrivate: 0,
			swith: []
		};
		postData({
			url: "DcCdOrganizationManage",
			params: {
				Action: "QueryForUser",
				Type: 'M'
			},
			success: function(ci_result) {
				var m_objData1 = [];
				var m_objData2 = [];
				$.each(ci_result.rows, function() {
					switch(this.iType) {
						case 0:
							m_objData1.push(this);
							break;
						case 1:
							m_objData2.push(this);
							break;
					}
					if(this.iOrgID == _objUserData.iOrgID) {
						m_objData.iOrgID = this.iOrgID;
						m_objData.cOrgName = this.cName;
						_objUserData.iOrgType = this.iType;
					}
				});
				if(m_objData1.length > 0) {
					m_objData.swith.push({
						iType: 0,
						cText: '企业版'
					});
					$('#div_TopMenu_Org').css('display', 'block');
					if(m_objData1.length == 1) {
						$('#div_Org').menu('destroy');
						$('#div_TopMenu_Org').addClass('nav-menu-item-only');
						$('#span_Org').text(m_objData.cOrgName);
					} else {
						setTopMenu('div_TopMenu_Org', 'div_Org');
						$.each(m_objData1, function() {
							var m_objItem = {
								text: this.cName,
								id: this.iOrgID
							}
							if(m_objData.iOrgID == this.iOrgID) {
								m_objItem.iconCls = 'icon-ok';
								$('#span_Org').text(this.cName);
							}
							$('#div_Org').menu('appendItem', m_objItem);
						});
					}
				}
				if(m_objData2.length > 0) {
					m_objData.swith.push({
						iType: 1,
						cText: '个人版'
					});
					m_objData.iOrgPrivate = m_objData2[0].iOrgID;
				}
				if(m_objData.swith.length > 1) {
					$('#div_TopMenu_OrgSwitch').css('display', 'block');
					if($('#div_OrgSwitch').length == 0) {
						$('<div id="div_OrgSwitch" class="easyui-menu" style="width: 190px; display: none; background: #fff;"></div>').appendTo('body');
					}
					setTopMenu('div_TopMenu_OrgSwitch', 'div_OrgSwitch');
					$.each(m_objData.swith, function() {
						var m_objItem = {
							text: this.cText,
							id: this.iType
						}
						if(this.iType == 1) {
							m_objItem.onclick = function() {
								_objUserData.iOrgType = 1;
								changeOrg(m_objData.iOrgPrivate);
							};
							if(m_objData.iOrgPrivate == m_objData.iOrgID) {
								m_objItem.iconCls = 'icon-ok';
								$('#span_OrgSwitch').text(m_objItem.text);
								$('#div_TopMenu_Org').hide();
							}
						} else {
							m_objItem.onclick = function() {
								_objUserData.iOrgType = 0;
								changeOrg(m_objData1[0].iOrgID);
							};
							if(m_objData.iOrgPrivate != m_objData.iOrgID) {
								m_objItem.iconCls = 'icon-ok';
								$('#span_OrgSwitch').text(m_objItem.text);
							}
						}
						$('#div_OrgSwitch').menu('appendItem', m_objItem);
					});
				} else if(m_objData2.length > 0) {
					$('#div_TopMenu_OrgSwitch,[group="updatetip"]').show();
					$('#div_OrgSwitch').menu('destroy');
					$('#div_TopMenu_OrgSwitch').addClass('nav-menu-item-only');
					$("#span_OrgSwitch").text(m_objData.swith[0].cText);
				}
				getUserGroupList();
			}
		});
	}

	function getUserGroupList() {
		$('#div_UserGroup').empty();
		postData({
			url: 'DcCdUserGroupMappingManage',
			params: {
				Action: 'Query',
				Type: 'M'
			},
			success: function(ci_result) {
				if(existData(ci_result)) {
					var m_objData = {
						iID: 0,
						cName: '',
						data: [],
						iPrivateID: 0
					};
					$.each(ci_result.rows, function() {
						if(this.bIsDisplay) {
							m_objData.data.push(this);
							if(_objUserData.iUserGroupID == this.iUserGroupID) {
								m_objData.iID = this.iUserGroupID;
								m_objData.cName = this.cGroupChiName;
							}
						} else if(this.cGroupCode != 'Default' && m_objData.iPrivateID == 0) {
							m_objData.iPrivateID = this.iUserGroupID;
						}
					});
					if(m_objData.data.length > 0) {
						$('#div_TopMenu_UserGroup').css('display', '');
						if(m_objData.data.length == 1) {
							$('#div_UserGroup').menu('destroy');
							$('#div_TopMenu_UserGroup').addClass('nav-menu-item-only');
						} else {
							setTopMenu('div_TopMenu_UserGroup', 'div_UserGroup');
							$.each(m_objData.data, function() {
								var m_objItem = {
									text: this.cGroupChiName,
									id: this.iUserGroupID
								}
								if(this.iUserGroupID == m_objData.iID) {
									m_objItem.iconCls = 'icon-ok';
								}
								$('#div_UserGroup').menu('appendItem', m_objItem);
							});
						}
						if(m_objData.iID == 0) {
							changeUserGroup(m_objData.data[0].iUserGroupID, m_objData.data[0].cGroupChiName);
						} else {
							$('#span_UserGroup').text(m_objData.cName);
							getQuickMenu();
							openDesktop();
						}
					} else {
						_objUserData.iUserGroupID = m_objData.iPrivateID;
						getQuickMenu();
						openDesktop();
					}
				}
			}
		});
	}

	function getQuickMenu() {
		$('#ul_QuickMenu').empty();
		postData({
			url: 'DcCdQuickMenuManage',
			isSys: true,
			params: {
				Action: "GetList",
				iUserGroupID: _objUserData.iUserGroupID
			},
			success: function(ci_result) {
				if(existData(ci_result)) {
					ci_result.rows.sort(function(a, b) {
						return a.iIndex - b.iIndex;
					});
					$.each(ci_result.rows, function(index, value) {
						var m_strClass = 'quick_default';
						var m_objHTML = [];
						if($.trim(value.cIconCls) != '') {
							m_strClass = value.cIconCls;
						}
						m_objHTML.push('<li group="ex">');
						m_objHTML.push('<a class="quickbtn ' + m_strClass + '" ');
						m_objHTML.push('href="javascript:void(0);" ');
						m_objHTML.push('title="' + value.cItemChiName + '" ');
						if(value.bIsVisible) {
							m_objHTML.push('onclick="createMenuTree(\'' + value.cTreeCode + '\', \'' + value.cMenuItemCode + '\', true);">');
						} else {
							m_objHTML.push('onclick="openTab(\'' + value.cTreeCode + '\', \'' + value.cMenuItemCode + '\', \'' + value.cItemChiName + '\',\'' + value.cClickUrl + '\');">');
						}
						m_objHTML.push('<span>' + value.cItemChiName + '</span>');
						m_objHTML.push('</a></li>');

						$(m_objHTML.join('')).appendTo('#ul_QuickMenu');
					});
				}
			}
		});
	}

	function updateUserName() {
		postData({
			url: "DcCdUserManage",
			params: {
				Action: "GetUserInfo"
			},
			success: function(ci_result) {
				if(ci_result.rows != undefined && ci_result.rows.length > 0) {
					_objUserData = ci_result.rows[0];
				}
				$("#span_User").html(_objUserData.cUserName);
				setCookie('loginname', _objUserData.cLoginName);
			}
		});
	}

	function selectedMenu(ci_objMenuItem) {
		var m_objItem = $(ci_objMenuItem)
		if(ci_objMenuItem.tatget) {
			m_objItem = $(ci_objMenuItem.target);
		}
		m_objItem.parent().find('.icon-ok').removeClass('icon-ok');
		m_objItem.parent().menu('setIcon', {
			target: m_objItem[0],
			iconCls: 'icon-ok'
		});
	}

	//menu中的item点击事件
	function mainMenuHandler(item) {
		if(item != undefined && item != null) {
			selectedMenu(item);
			switch(item.id) {
				case "UserLogout":
					userLogout();
					break;
				case "UserCompanySel":
					openCompanySelectWindow();
					break;
				default:
					createMenuTree(item.id, '', false, '');
					break;
			}
		}
	};

	function orgMenuHandler(item) {
		if(item != undefined && item != null) {
			if(item.id != _objUserData.iOrgID) {
				changeOrg(item.id);
			}
		}
	}

	function changeOrg(ci_iOrgID) {
		postData({
			url: "DcCdUserManage",
			params: {
				Action: "SetOrg",
				"OrgID": ci_iOrgID
			},
			success: function(ci_result) {
				top.window.location = 'main.html?T=' + Math.random().toString().replace(/0./, '');
			},
			failure: function(ci_result) {
				$.messager.alert('提示', '选择组织失败', 'info');
			}
		});
	}

	function userGroupMenuHandler(item) {
		if(item != undefined && item != null) {
			if(item.id != _objUserData.iUserGroupID) {
				changeUserGroup(item.id, item.text);
			}
		}
	}

	function changeUserGroup(ci_iUserGroupID, ci_strUserGroupName) {
		postData({
			url: "DcCdUserManage",
			params: {
				Action: "SetRole",
				"RoleID": ci_iUserGroupID
			},
			success: function(ci_result) {
				_objUserData.iUserGroupID = ci_iUserGroupID;
				$("#span_UserGroup").text(ci_strUserGroupName);
				selectedMenu($('#div_UserGroup').find('#' + _objUserData.iUserGroupID));
				if(_strMenuCode == "Desktop" || _strMenuCode == '') {
					top.location.hash = '';
					openDesktop();
				}
				getQuickMenu();
			}
		});
	}

	//设定layout的标题
	function setLayoutTitle(ci_strTreeID, title) {
		$('body').layout('panel', 'west').panel('setTitle', title);
		selectedMenu($("#mainMenu").find('#' + ci_strTreeID.split('_')[1]));
	}

	function setMenuCloseTime(ci_strMenuID) {
		for(var i = 0; i < _objMenuList.length; i++) {
			if(_objMenuList[i].menuID == ci_strMenuID) {
				_objMenuList[i].timer = window.setTimeout("$('#" + ci_strMenuID + "').menu('hide')", _iMenuDelay);
				return;
			}
		}
		_objMenuList.push({
			menuID: ci_strMenuID,
			timer: window.setTimeout("$('#" + ci_strMenuID + "').menu('hide')", _iMenuDelay)
		});
	}

	function cancelMenuCloseTime(ci_strMenuID) {
		for(var i = 0; i < _objMenuList.length; i++) {
			if(_objMenuList[i].menuID == ci_strMenuID) {
				if(_objMenuList[i].timer) {
					window.clearTimeout(_objMenuList[i].timer);
					_objMenuList[i].timer = null;
				}
				return;
			}
		}
	}

	function userLogout() {
		$.post("Ajax/DcCdLogin.ashx", {
			"action": "logout"
		}, function(result) {
			result = convertToJson(result);
			if(checkReturnJson(result)) {
				setCookie('IsSave', '');
				setCookie('UserCertification', '');
				location.href = "Login.html";
			} else {
				$.messager.alert('提示', '退出失败', 'info');
			}
		}).error(function(err) {
			alert(err.responseText);
		});
	}

	function openLoginWindow(ci_objWindow) {
		if(getCookie('UserCertification') == '') {
			location.href = 'Login.html';
		} else {
			_objWindow = ci_objWindow;
			popupDialog('Login.html', '', '', true, 0, 0);
		}
	}

	var _iNorthHeight = 0;
	var _iHeaderHeight = 0;
	var _iWestWidth = 0;

	function screenFull(isfull) {
		if(isfull) {
			if($('body').layout("panel", "west").css("display") == "none") {
				$('.layout-expand').css("display", "none");
			}
			_iWestWidth = $('body').layout("panel", "west").panel("options").width;
			_iNorthHeight = $('body').layout("panel", "north").panel("options").height;
			_iHeaderHeight = $(".tabs-header").height();
			$('body').layout("panel", "west").panel("options").width = 0;
			$('body').layout("panel", "north").panel("options").height = 0;
			$(".tabs-header").height(0);
			$('body').layout("resize");
		} else {
			if($('body').layout("panel", "west").css("display") == "none") {
				$('.layout-expand').css("display", "block");
			}
			$('body').layout("panel", "west").panel("options").width = _iWestWidth;
			$('body').layout("panel", "north").panel("options").height = _iNorthHeight;
			$(".tabs-header").height(_iHeaderHeight);
			$(".tabs-header").css("display", "");
			$('body').layout("resize");
		}
	}

	function openSuggest() {
		popupDialog('Platform/SysSuggestDetail.html', '', '建议与投诉', false, 550, 300);
	}
</script>